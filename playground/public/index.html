<html>
	<head>
		
		<title>HTML5 Audio Visualizations</title>

		<script type="text/javascript" src="js/libs/paper.js"></script>
		<script type="text/javascript" src="js/libs/webaudio.js"></script>
		<script type="text/javascript" src="js/libs/tweeneasing.js"></script>


		<style type="text/css">
			html { overflow: hidden;}
			body { margin:0; }
		</style>

		<script type="text/javascript">
		paper.install(window);
		window.onload = function() {
			paper.setup('myCanvas');

			try {
				// init the library
		    var webaudio	= new WebAudio();
		  }
		  catch(e) {
		    alert('WebAudio is not supported in this browser (use Chrome)');
		  }

		  // create a sound
			var sound	= webaudio.createSound();
			// load sound.wav and play it
			//sound.load('sound/step1.ogg', function(sound){
			sound.load('sound/LMFAO_Party_Rock_Anthem_8Bit.mp3', function(sound){
				sound.loop(true).play();
			});

			var path = new Path();
      path.fillColor = 'black';

      var points = 20 + Math.floor(Math.random() * 10);
      path.closed = true;
      for (var i = 0; i <= points; i++) {
          var delta = new paper.Point({
            length: (150 * 0.5) + (Math.random() * 150 * 0.5),
            angle: (360 / points) * i
          });
          delta.y += view.center.y;
          delta.x += view.center.x; 
          path.add(delta);
      }
      path.smooth();
      view.draw();
				

			setInterval(onFrame, 1000/60);
			
			function onFrame(event){
				// neutral value
				var min		= 0;
				var max		= 1;
				var offset	= 0;
				var range	= 1;
				var tweenFn	= TWEEN.Easing.Linear.None;
				// normalization of the scale
				var scale	= sound.amplitude();
				// apply the formula
				scale		= Math.min(scale, max);
				scale		= Math.max(scale, min);
				scale		-= min;
				scale		/= max == min ? 1 : max - min;
				scale		= tweenFn(scale);
				scale		*= range;
				scale		+= offset;

				//path.segments[0].point.y = scale*100;

	    	for (var i = 0; i <= points; i++) {
	        var segment = path.segments[i];	        
	        segment.point.y = scale * height + 100;
		    }
				
				view.draw();
			}; 

		}

		</script>

	</head>
	<body>
		<canvas id="myCanvas" resize></canvas>
	</body>
</html>